# Proposed Project Structure — musicboard_2

Ниже — адаптированная и конкретная предлагаемая структура проекта, основанная на `docs/review.md` и текущем состоянии репозитория. Также даются краткие пояснения и план миграции (итеративный).

---

## Цели этой реструктуризации
- Разделить исходники (`src`) и публичные (готовые к раздаче) файлы (`public` / `dist`).
- Ясная модульность JS (features + shared), упрощающая рефакторинг и тесты.
- Централизация PHP API (endpoint'ы, сервисы, валидаторы, ядро).
- Автоматизация сборки (Vite) и предсказуемая установка зависимостей (`package.json` + `package-lock.json`).
- Легкая миграция стилей (SCSS) и статических ассетов (public).

---

## Предложенная структура (конкретно для вашего проекта)

musicboard_2/
├── src/
│   ├── js/
│   │   ├── app/
│   │   │   ├── App.js                # Точка входа (инициализация приложения)
│   │   │   ├── bootstrap.js         # Быстрая инициализация (env, DI)
│   │   │   └── Router.js            # Если потребуется client-side routing
│   │   ├── features/
│   │   │   ├── search/
│   │   │   │   ├── SearchBar.js
│   │   │   │   ├── SearchModal.js
│   │   │   │   └── SearchService.js # Убрать дублирование логики поиска
│   │   │   ├── albums/
│   │   │   │   ├── AlbumGrid.js
│   │   │   │   ├── AlbumCard.js
│   │   │   │   └── AlbumMenu.js
│   │   │   ├── ratings/
│   │   │   │   ├── RatingModal.js
│   │   │   │   ├── RatingManager.js
│   │   │   │   └── RatingService.js
│   │   │   └── auth/
│   │   │       ├── AuthForm.js
│   │   │       └── AuthService.js
│   │   ├── shared/
│   │   │   ├── components/
│   │   │   │   ├── Modal.js
│   │   │   │   ├── Dropdown.js
│   │   │   │   └── StarRating.js
│   │   │   ├── services/
│   │   │   │   ├── HttpClient.js    # Централизует fetch/timeout/proxy
│   │   │   │   └── CacheService.js
│   │   │   └── utils/
│   │   │       ├── dom.js
│   │   │       ├── eventBus.js
│   │   │       └── formatters.js
│   │   └── config/
│   │       ├── constants.js         # константы приложения
│   │       └── environment.js       # import.meta.env mapping
│   ├── scss/
│   │   ├── abstracts/               # переменные, миксины, функции
│   │   │   ├── _variables.scss
│   │   │   ├── _mixins.scss
│   │   │   └── _breakpoints.scss
│   │   ├── base/
│   │   │   ├── _reset.scss
│   │   │   └── _typography.scss
│   │   ├── components/              # кнопки, карточки, модалки и т.д.
│   │   └── pages/
│   │       └── _home.scss
│   └── index.html                   # dev entry (Vite serves from src by default or public)
├── public/                          # статические файлы (не обрабатываются сборщиком)
│   ├── img/
│   ├── uploads/
│   └── favicon.ico
├── php/                             # серверная логика — оставляем вне src для развёртывания
│   ├── api/
│   │   ├── albums.php
│   │   ├── ratings.php
│   │   └── auth.php
│   ├── services/
│   │   ├── AlbumService.php
│   │   ├── RatingService.php
│   │   └── CoverService.php
│   ├── core/
│   │   ├── Database.php
│   │   ├── Router.php
│   │   ├── Request.php
│   │   └── Response.php
│   ├── validators/
│   │   ├── InputValidator.php
│   │   └── RatingValidator.php
│   └── utils/
│       ├── Logger.php
│       └── ErrorHandler.php
├── scripts/                         # миграции, вспомогательные скрипты (не в production root)
│   └── migrate_passwords.php
├── tests/                           # unit/integration (по мере внедрения)
│   ├── unit/
│   └── integration/
├── dist/                            # generated by `npm run build` (gitignored)
├── .env.example
├── .gitignore
├── package.json
├── package-lock.json
├── vite.config.js
└── README.md

---

## Ключевые примечания и отличия от текущего состояния
- `src/` — основная рабочая зона для фронтенда. `public/` — статические файлы, которые не хешируются и доступны по прямым путям (`/img/...`).
- `php/` остаётся отдельным и разворачиваемым, с чётким разделением API, сервисов и инфраструктуры.
- JS разбит по feature-папкам — это следствие аудита (см. `docs/review.md`) — уменьшает дублирование и упрощает тестирование.
- SCSS реорганизован в `abstracts`, `components`, `pages` — это облегчит повторное использование миксинов и переменных.
- Добавлен `scripts/` для вспомогательных задач (миграции), что уберёт ненужные файлы из корня проекта.

---

## Пошаговый план миграции (итеративно, минимально риско)
1) Подготовка (1–2 часа)
   - Создать `src/` и `public/` в репозитории (без удаления текущих файлов, просто перемещать/копировать по шагам).
   - Добавить `vite` + `sass` (они уже в `package.json` — проверьте `npm ci`).
   - Создать `.env.example` (если ещё нет).

2) Миграция входной точки (1–2 дня)
   - Скопировать `index.html` в `src/index.html` или `public/index.html` согласно `vite.config.js`.
   - В `src/js` перенести `js/main.js` и папки `components`, `services`, `managers` в `src/js/features` / `src/js/shared` по мере рефакторинга.
   - В `main.js` заменить подключение стилей на `import '../scss/main.scss';` (для HMR).

3) SCSS (полдня)
   - Создать `src/scss/abstracts/_variables.scss` и начать выносить повторяющиеся переменные и миксины.

4) PHP и прокси (полдня)
   - Запустить локальный PHP-server (например, `php -S localhost:8000 -t php/`) и настроить `vite.config.js` proxy → `/php` → `http://localhost:8000`.

5) Рефакторинг по задачам (итеративно)
   - Реализовать `SearchService.js` и удалить дублирование в `SearchManager`.
   - Вынести `HttpClient`.
   - Разбить `main.js` когда всё стабильно.

6) Очистка и завершение
   - Переместить устаревшие файлы в `scripts/` или удалить (см. `docs/review.md` список).
   - Обновить `.gitignore` (ignore `node_modules`, `dist`, `.env`).

---

## Быстрые рекомендации (что сделать прямо сейчас)
- Оставьте `package.json` и `package-lock.json` — не удаляйте.
- Добавьте `.gitignore` если нет (node_modules, dist, .env, .idea).
- Не перемещайте всё сразу — делайте по фичам (Search → Ratings → Albums).
- Настройте `vite.config.js` proxy к вашему локальному PHP; это снимет проблемы с CORS.
- Импортируйте главный SCSS через `main.js` для HMR.

---

Если хотите — могу подготовить патч (diff) с начальной минимальной операцией: создать `src/` и переместить `js/main.js` в `src/js/app/App.js`, обновить `index.html` и добавить `vite.config.js` пример — но не буду применять без вашего подтверждения.

