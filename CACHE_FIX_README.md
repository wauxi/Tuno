# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –∫—ç—à–µ–º –æ–±–ª–æ–∂–µ–∫

## –ü—Ä–æ–±–ª–µ–º—ã –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:

### 1. –î—É–±–ª–∏–∫–∞—Ç—ã –≤ —Ç–∞–±–ª–∏—Ü–µ `album_covers_cache`
**–ü—Ä–∏—á–∏–Ω–∞**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ UNIQUE KEY –Ω–∞ `album_id`, –∏–∑-–∑–∞ —á–µ–≥–æ `ON DUPLICATE KEY UPDATE` –Ω–µ —Ä–∞–±–æ—Ç–∞–ª.

**–†–µ—à–µ–Ω–∏–µ**:
- –ò–∑–º–µ–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤ `CoverService.php::cacheCover()` - —Ç–µ–ø–µ—Ä—å —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
- –°–æ–∑–¥–∞–Ω SQL —Å–∫—Ä–∏–ø—Ç `fix_covers_cache.sql` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è UNIQUE KEY

**–ó–∞–ø—É—Å—Ç–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç:**
```sql
-- –í phpMyAdmin –∏–ª–∏ MySQL –∫–ª–∏–µ–Ω—Ç–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞:
fix_covers_cache.sql
```

### 2. –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –æ–±–ª–æ–∂–µ–∫ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞
**–ü—Ä–∏—á–∏–Ω–∞**: 
- TTL –∫—ç—à–∞ –æ–±–ª–æ–∂–µ–∫ –±—ã–ª 6 —á–∞—Å–æ–≤
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞ –æ—á–∏—â–∞–ª—Å—è –≤–µ—Å—å localStorage
- –û–±–ª–æ–∂–∫–∏ –∑–∞–≥—Ä—É–∂–∞–ª–∏—Å—å –∑–∞–Ω–æ–≤–æ –∏–∑ Spotify API (–º–µ–¥–ª–µ–Ω–Ω–æ)

**–†–µ—à–µ–Ω–∏–µ**:
- –£–≤–µ–ª–∏—á–µ–Ω TTL –∫—ç—à–∞ –æ–±–ª–æ–∂–µ–∫ –¥–æ **30 –¥–Ω–µ–π** (–æ–±–ª–æ–∂–∫–∏ –∞–ª—å–±–æ–º–æ–≤ —Ä–µ–¥–∫–æ –º–µ–Ω—è—é—Ç—Å—è)
- –í–º–µ—Å—Ç–æ –æ—á–∏—Å—Ç–∫–∏ localStorage –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–ª–∞–≥ `needsFreshData` –≤ sessionStorage
- –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞
- –û–±–ª–æ–∂–∫–∏ –±–µ—Ä—É—Ç—Å—è –∏–∑ –ë–î –∫—ç—à–∞ (–±—ã—Å—Ç—Ä–æ!)
- –ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ localStorage —Å –æ–±–ª–æ–∂–∫–∞–º–∏

### 3. –°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞
**–ü—Ä–∏—á–∏–Ω–∞**: Race condition –º–µ–∂–¥—É `clearCache()` –∏ `window.location.reload()`

**–†–µ—à–µ–Ω–∏–µ**: 
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è sessionStorage —Ñ–ª–∞–≥ —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–µ–∂–µ—Å—Ç–∏ —Ñ–ª–∞–≥–∞ (< 5 —Å–µ–∫—É–Ω–¥)
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–µ–ø–µ—Ä—å:

### –ü—Ä–∏ –æ–±—ã—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ (F5):
1. –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ localStorage (–µ—Å–ª–∏ –∫—ç—à –≤–∞–ª–∏–¥–µ–Ω < 1 —á–∞—Å)
2. –û–±–ª–æ–∂–∫–∏ —É–∂–µ –µ—Å—Ç—å –≤ –¥–∞–Ω–Ω—ã—Ö
3. ‚ö° **–ë—ã—Å—Ç—Ä–æ!**

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞:
1. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ñ–ª–∞–≥ `needsFreshData` —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –º–µ—Ç–∫–æ–π
2. –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç `reload()`
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ñ–ª–∞–≥ (< 5 —Å–µ–∫—É–Ω–¥ –Ω–∞–∑–∞–¥)
4. –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞
5. –û–±–ª–æ–∂–∫–∏ –±–µ—Ä—É—Ç—Å—è –∏–∑ –ë–î –∫—ç—à–∞ (TTL 30 –¥–Ω–µ–π)
6. ‚ö° **–ë—ã—Å—Ç—Ä–æ!**
7. –ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ localStorage

## –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:

1. ‚úÖ –ö–æ–¥ —É–∂–µ –æ–±–Ω–æ–≤–ª—ë–Ω
2. ‚ö†Ô∏è **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û**: –ó–∞–ø—É—Å—Ç–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç `fix_covers_cache.sql` –≤ –≤–∞—à–µ–π –ë–î
3. üßπ –û—á–∏—Å—Ç–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –¥—É–±–ª–∏–∫–∞—Ç—ã –æ–±–ª–æ–∂–µ–∫

## –ü—Ä–æ–≤–µ—Ä–∫–∞:

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 0 —Å—Ç—Ä–æ–∫):
SELECT album_id, COUNT(*) as count 
FROM album_covers_cache 
GROUP BY album_id 
HAVING count > 1;

-- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π:
SELECT COUNT(*) FROM album_covers_cache;
```
